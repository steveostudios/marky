<html>
<head>
	<title>Marky</title>
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
	<link rel="stylesheet" href="assets/lib/pe-icon-7-stroke/css/pe-icon-7-stroke.css">
</head>
<body>
	<div id="header">
		<div class="header_list">
			<i id="btn_add" class="icon pe-7s-plus"></i><i id="btn_about" class="icon pe-7s-info"></i><i id="btn_edit" class="icon pe-7s-more"></i>
		</div>
		<div class="header_edit">
			<i class="btn_edit_confirm icon pe-7s-check"></i><i class="btn_edit_cancel icon pe-7s-close-circle"></i>
		</div>
	</div>
	<div id="pane_about">
		<img src="assets/img/icon.svg" alt="Marky">
		<h1>Marky</h1>
		<p>&copy;2015 steveostudios</p>
	</div>
	<div id="pane_list_and_edit">
		<div id="pane_list">
			<ul id="list_links"></ul>
		</div>
		<div id="pane_edit">
			<form>
				<input type="hidden" id="inp_id" name="inp_id"/>
				<div class="form_group">
					<label for="inp_name">Name</label>
					<input type="text" id="inp_name" name="inp_name"/>
				</div>

				<div class="form_group">
					<label for="inp_type">Type</label>
					<select id="inp_type" name="inp_type">
						<option>Select a type</option>
						<option value="vnc">VNC</option>
						<option value="http">Link</option>
					</select>
				</div>

				<div class="form_group">
					<label for="inp_icon">Icon</label>
					<input type="hidden" id="inp_icon" name="inp_icon"/>
					<div class="selected_icon"></div> <div class="btn_item_change_icon">Change Icon</div>
				</div>

				<div class="form_group">
					<label for="inp_url">URL</label>
					<input type="text" id="inp_url" name="inp_url"/>
				</div>

				<div class="form_group">
					<div class="btn_item_delete">Delete</div>
					<div class="item_delete_yousure">
						<label>Are you sure?</label>
						<div class="btn_item_delete_confirm">Yes</div><div class="btn_item_delete_cancel">No</div>
					</div>
				</div>
			</form>
		</div>
		<div id="pane_edit_icon">
			<ul></ul>
		</div>
	</div>
	<!-- <script type="text/javascript" src="assets/lib/jquery-2.1.3.min.js"></script> -->
	<!-- <script type="text/javascript" src="assets/lib/jquery-ui-1.11.4.custom/jquery-ui.min.js"></script> -->
  <script type="text/javascript">
  	window.$ = window.jQuery = require('./assets/lib/jquery-2.1.3.min.js');
  	require('./assets/lib/jquery-ui-1.11.4.custom/jquery-ui.min.js');
  	var ipc = require('ipc');
		var icons = ['album','arc','back-2','bandaid','car','diamond','door-lock','eyedropper','female','gym','hammer','headphones','helm','hourglass','leaf','magic-wand','male','map-2','next-2','paint-bucket','pendrive','photo','piggy','plugin','refresh-2','rocket','settings','shield','smile','usb','vector','wine','cloud-upload','cash','close','bluetooth','cloud-download','way','close-circle','id','angle-up','wristwatch','angle-up-circle','world','angle-right','volume','angle-right-circle','users','angle-left','user-female','angle-left-circle','up-arrow','angle-down','switch','angle-down-circle','scissors','wallet','safe','volume2','volume1','voicemail','video','user','upload','unlock','umbrella','trash','tools','timer','ticket','target','sun','study','stopwatch','star','speaker','signal','shuffle','shopbag','share','server','search','film','science','disk','ribbon','repeat','refresh','add-user','refresh-cloud','paperclip','radio','note2','print','network','prev','mute','power','medal','portfolio','like2','plus','left-arrow','play','key','plane','joy','photo-gallery','pin','phone','plug','pen','right-arrow','paper-plane','delete-user','paint','bottom-arrow','notebook','note','next','news-paper','musiclist','music','mouse','more','moon','monitor','micro','menu','map','map-marker','mail','mail-open','mail-open-file','magnet','loop','look','lock','lintern','link','like','light','less','keypad','junk','info','home','help2','help1','graph3','graph2','graph1','graph','global','gleam','glasses','gift','folder','flag','filter','file','expand1','exapnd2','edit','drop','drawer','download','display2','display1','diskette','date','cup','culture','crop','credit','copy-file','config','compass','comment','coffee','cloud','clock','check','chat','cart','camera','call','calculator','browser','box2','box1','bookmarks','bicycle','bell','battery','ball','back','attention','anchor','albums','alarm','airplay'];
  	var links = [
		 //  {
		 //  	"id": 0,
		 //    "name": "Block Auditorium Graphics Computer",
		 //    "type": "vnc",
		 //    "icon": "play",
		 //    "url": "10.100.49.101",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 3
		 //  },
		 //  {
		 //  	"id": 1,
		 //    "name": "Auditorium Lyrics",
		 //    "type": "vnc",
		 //    "icon": "music",
		 //    "url": "10.100.49.102",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 1
		 //  },
		 //  {
		 //  	"id": 2,
		 //    "name": "Auditorium Record",
		 //    "type": "vnc",
		 //    "icon": "film",
		 //    "url": "10.100.49.103",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 2
		 //  },
		 //  {
		 //  	"id": 3,
		 //    "name": "Room 21 iMac",
		 //    "type": "vnc",
		 //    "icon": "cash",
		 //    "url": "10.100.49.101",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 0
		 //  },
		 //  {
		 //  	"id": 4,
		 //    "name": "Room 21 Lighting",
		 //    "type": "vnc",
		 //    "icon": "light",
		 //    "url": "10.100.49.102",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 4
		 //  },
		 //  {
		 //  	"id": 5,
		 //    "name": "Room 21 Clock",
		 //    "type": "vnc",
		 //    "icon": "clock",
		 //    "url": "10.100.49.103",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 5
		 //  },
		 //  {
		 //  	"id": 6,
		 //    "name": "FOH iMac",
		 //    "type": "vnc",
		 //    "icon": "music",
		 //    "url": "10.100.49.103",
		 //    "user": "blocktech",
		 //    "password": "TheOctagon01",
		 //    "order": 6
		 //  }
  	];

		$('#list_links').on('click', 'li .link_item', function(event) {
			event.preventDefault();
		  link_goto($(this).parent().data('url'));
		});
		var mode = 'list';
		$('#header').on('click', '#btn_about', function(event) {
			event.preventDefault();
			var speed = 200;
			if (mode == 'list') {
				left = 200;
				$('#pane_list_and_edit').css('border-left', '1px solid #ededee');
				mode = 'about';
			} else if (mode == 'about') {
				left = -0;
				mode = 'list';
				$('#pane_list_and_edit').css('border-left', 'none');
			}
	  	$('#pane_list_and_edit').animate({ "left": left +"px" }, speed );
		});

		$('#header').on('click', '#btn_edit', function(event) {
			event.preventDefault();
			var speed = 200;
			if(mode == 'edit') {
				$('.link_item').animate({'width': '220px'}, speed);
				$('.link_edit').animate({'left': '250px'}, speed);
				$('#btn_add').animate({'left': '-35px'}, speed);
				mode = 'list';
			} else if(mode == 'list') {
				$('.link_item').animate({'width': '165px'}, speed);
				$('.link_edit').animate({'left': '195px'}, speed);
				$('#btn_add').animate({'left': '0'}, speed);
				mode = 'edit';
			}
		});

		$('#list_links').on('click', '.btn_edit_item', function(event) {
			event.preventDefault();
			var item_id = $(this).parent().parent().data('id');
			$('#inp_id').val(item_id);
			$('#inp_name').val(links[item_id].name);
			$('#inp_type').val(links[item_id].type);
			$('#inp_icon').val(links[item_id].icon);
			$('.selected_icon').html('<i class="icon pe-7s-'+ links[item_id].icon +'"></i>');
			$('#inp_url').val(links[item_id].url);
			var speed = 200;
			$('#pane_list_and_edit').animate({'left': '-250px'}, speed);
			$('#header').animate({'left': '-250px'}, speed);
			$('#btn_add').animate({'left': '-35px'}, speed);
			mode = 'edit_item';
		});

		function getObjByProp(arr, prop, attr) {
			for (var i = 0; i < arr.length; i++) {
			  if (arr[i][prop] == attr){
					return arr[i];
			  }
			}
		}

		$('#header').on('click', '#btn_add', function(event) {
			event.preventDefault();
			var new_key = 0;
			alert(links.length);
			if (links.length > 0) {
				for (var key in links) {
					if(key > new_key) {
						new_key = key;
					}
				}
			}
			
			new_key++;
			$('#inp_id').val(new_key);
			$('#inp_name').val('');
			$('#inp_type').val('');
			$('#inp_icon').val('');
			$('.selected_icon').html('');
			$('#inp_url').val('');
			var speed = 200;
			$('#pane_list_and_edit').animate({'left': '-250px'}, speed);
			$('#header').animate({'left': '-250px'}, speed);
			$('#btn_add').animate({'left': '-35px'}, speed);
			mode = 'add_item';
		});

		$('#pane_edit').on('click', '.btn_item_change_icon', function(event) {
			var current_icon = $('#inp_icon').val();
			build_icons(current_icon);
			var speed = 200;
			$('#pane_list_and_edit').animate({'left': '-500px'}, speed);
			$('#header').animate({'left': '-500px'}, speed);
			mode = 'edit_item_icon';
		});

		$('#pane_edit_icon ul').on('click', 'li', function(event) {
			var new_icon = $(this).attr('id').substring(5);
			$('#inp_icon').val(new_icon);
			$('.selected_icon').html('<i class="icon pe-7s-'+ new_icon +'"></i>');
			var speed = 200;
			$('#pane_list_and_edit').animate({'left': '-250px'}, speed);
			$('#header').animate({'left': '-250px'}, speed);
			mode = 'edit_item';
		});


		$('.header_edit').on('click', '.btn_edit_confirm', function(event) {
			var edited_item = {};
			edited_item.name = $('#inp_name').val();
			edited_item.icon = $('#inp_icon').val();
			edited_item.type = $('#inp_type').val();
			edited_item.url = $('#inp_url').val();
			links[$('#inp_id').val()] = edited_item;
			var sorted_list = $('#list_links').sortable('toArray', {data: 'id'});
			for (i = 0; i < sorted_list.length; ++i) {
				var link_id = sorted_list[i];
				getObjByProp(links, 'id', link_id).order = i;
			}
			links_save();
			links_build();
			var speed = 200;
			$('.link_item').css({'width': '220px'});
			$('.link_edit').css({'left': '250px'});
			$('#pane_list_and_edit').animate({'left': '0'}, speed);
			$('#header').animate({'left': '0'}, speed);
			mode = 'list';
		});

		$('.header_edit').on('click', '.btn_edit_cancel', function(event) {
			var speed = 200;
			$('.link_item').css({'width': '220px'});
			$('.link_edit').css({'left': '250px'});
			$('#pane_list_and_edit').animate({'left': '0'}, speed);
			$('#header').animate({'left': '0'}, speed);
			mode = 'list';
		});

		$('#pane_edit').on('click', '.btn_item_delete', function(event) {
			$('.item_delete_yousure').show();
			$(this).hide();
		});

		$('#pane_edit').on('click', '.btn_item_delete_confirm', function(event) {
			delete links[$('#inp_id').val()];
			links_save();
			links_build();
			var speed = 200;
			$('.link_item').css({'width': '200px'});
			$('.link_edit').css({'left': '250px'});
			$('#pane_list_and_edit').animate({'left': '0'}, speed);
			$('#header').animate({'left': '0'}, speed);
			mode = 'list';
			$('.btn_item_delete').show();
			$('.item_delete_yousure').hide();
		});

		$('#pane_edit').on('click', '.btn_item_delete_cancel', function(event) {
			$('.btn_item_delete').show();
			$('.item_delete_yousure').hide();
		});

		function build_icons(current) {
			$('#pane_edit_icon ul').html('');
			for (var i = 0; i < icons.length; i++) {
				var selected = '';
				if (current) {
					if (icons[i] == current) {
						selected = ' selected';
					}
				}
    		$('#pane_edit_icon ul').append('<li id="icon_'+ icons[i] +'" class="'+ selected +'"><i class="icon pe-7s-'+ icons[i] +'"></i></li>');
			}
		}

		function sortByProp(prop) {
		  'use strict';
		  return function (a, b) {
		    var sortStatus = 0;
		    if (a[prop] < b[prop]) {
		      sortStatus = -1;
		    } else if (a[prop] > b[prop]) {
		      sortStatus = 1;
		    }
		    return sortStatus;
		  };
		}

		function links_build() {
			$('#list_links').html('');
			if(links.length < 1) {
				$('#list_links').append('<li>Add a new item first.</li>')
			}
			links.sort(sortByProp('order'));
			for (var key in links) {
				$('#list_links').append('<li data-id="'+ key +'" data-url="'+ links[key].url +'"><div class="link_item"><i class="icon pe-7s-'+ links[key].icon +'"></i>'+ links[key].name +'</div><div class="link_edit"><i class="icon pe-7s-edit btn_edit_item"></i><i class="icon pe-7s-menu btn_handle_item"></i></div></li>');
			}
			$('#list_links').sortable({
				handle: '.btn_handle_item',
				axis: 'y'
			});
		}

		function link_goto(url) {
			var arg_send = {
				url: url
			}
			ipc.send('goto_link', arg_send);
		}

		function links_save() {
			ipc.send('save_linkfile', links);
		}

		ipc.on('asynchronous-reply', function(arg) {
		  console.log(arg); // prints "pong"
		});

		ipc.on('open_linkfile', function(arg_receive) {
		  links = arg_receive;
		  links_build();
		});

		$(function() {
			ipc.send('open_linkfile');
		});

	</script>
</body>
</html>
